<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://xamarin.com/schemas/2014/forms"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:maps="clr-namespace:Xamarin.Forms.Maps;assembly=Xamarin.Forms.Maps"
    x:Class="Puma.Views.MainPage"
    xmlns:local="clr-namespace:Puma.CustomRenderer;assembly=Puma"
    xmlns:viewmodel="clr-namespace:Puma.ViewModels"
    xmlns:control="clr-namespace:Puma.ControlTemplates"
    xmlns:ffimageloadingsvg="clr-namespace:FFImageLoading.Svg.Forms;assembly=FFImageLoading.Svg.Forms"
    BackgroundColor="{AppThemeBinding 
                              Dark={StaticResource WindowBackgroundColorDark}, 
                              Light={StaticResource WindowBackgroundColor}}">





    <Grid
        Margin="0"
        Padding="0"
        ColumnDefinitions="80,1*,1*,1*,1*,1*,1*,1*,1*,1*,1*,1*"
        RowDefinitions="80,100,1*,1*,1*,1*,1*,1*,1*,1*,1*,80">


        <!-- GRID OUTLINES -->
        <!--<Label Background="blue" Grid.Column="1" Grid.Row="0"  Grid.RowSpan="12"/>
        <Label Background="blue" Grid.Column="3"  Grid.Row="0"  Grid.RowSpan="12"/>
        <Label Background="blue" Grid.Column="5" Grid.Row="0" Grid.RowSpan="12"/>
        <Label Background="blue" Grid.Column="7"  Grid.Row="0"  Grid.RowSpan="12"/>
        <Label Background="blue" Grid.Column="9" Grid.Row="0"  Grid.RowSpan="12"/>
        <Label Background="blue" Grid.Column="11"  Grid.Row="0"  Grid.RowSpan="12"/>
        <Label Background="blue" Grid.Row="0" Text="Hello" FontSize="2" Grid.ColumnSpan="12"/>
        <Label Background="blue" Grid.Row="2" Text="Hello" FontSize="2" Grid.ColumnSpan="12"/>
        <Label Background="blue" Grid.Row="4" Text="Hello" FontSize="2" Grid.ColumnSpan="12"/>
        <Label Background="blue" Grid.Row="6" Text="Hello" FontSize="2" Grid.ColumnSpan="12"/>
        <Label Background="blue" Grid.Row="8" Text="Hello" FontSize="2" Grid.ColumnSpan="12"/>
        <Label Background="blue" Grid.Row="10" Text="Hello" FontSize="2" Grid.ColumnSpan="12"/>-->


        <!-- MAP -->
        <maps:Map
            x:Name="map"
            MapClicked="OnMapClicked"
            Grid.RowSpan="12"
            Grid.ColumnSpan="12"
            MapType="Street"
            Background="{AppThemeBinding 
                              Dark={StaticResource WindowBackgroundColorDark}, 
                              Light={StaticResource WindowBackgroundColor}}"
            BackgroundColor="{AppThemeBinding 
                              Dark={StaticResource WindowBackgroundColorDark}, 
                              Light={StaticResource WindowBackgroundColor}}"
            AbsoluteLayout.LayoutFlags="All"
            AbsoluteLayout.LayoutBounds="0,0,1,1">

            <x:Arguments>
                <maps:MapSpan>
                    <x:Arguments>
                        <maps:Position>
                            <x:Arguments>
                                <x:Double>36.9628066</x:Double>
                                <x:Double>-122.0194722</x:Double>
                            </x:Arguments>
                        </maps:Position>
                        <x:Double>111</x:Double>
                        <x:Double>111</x:Double>
                    </x:Arguments>
                </maps:MapSpan>
            </x:Arguments>
        </maps:Map>


        <!-- MAP TYPES -->
        <StackLayout
            Grid.Column="10"
            Grid.ColumnSpan="2"
            Grid.Row="2"
            WidthRequest="70"
            HeightRequest="80"
            HorizontalOptions="EndAndExpand"
            VerticalOptions="FillAndExpand"
            x:Name="slMapTypes">
            <local:CustomButton
                Clicked="ViewOptionButton_Clicked"
                BackgroundColor="{AppThemeBinding Dark={StaticResource PopUpBackgroundColorDark},
            Light={StaticResource PopUpBackgroundColor}}"
                Text="Satellite"></local:CustomButton>
            <local:CustomButton
                Clicked="ViewOptionButton_Clicked"
                BackgroundColor="{AppThemeBinding Dark={StaticResource PopUpBackgroundColorDark},
            Light={StaticResource PopUpBackgroundColor}}"
                Text="Hybrid"></local:CustomButton>
            <local:CustomButton
                Clicked="ViewOptionButton_Clicked"
                BackgroundColor="{AppThemeBinding Dark={StaticResource PopUpBackgroundColorDark},
            Light={StaticResource PopUpBackgroundColor}}"
                Text="Street"></local:CustomButton>
        </StackLayout>


        <!-- NAVBAR AND MENU -->
        <AbsoluteLayout
            BackgroundColor="{AppThemeBinding 
                              Dark={StaticResource WindowBackgroundColorDark}, 
                              Light={StaticResource WindowBackgroundColor}}"
            HorizontalOptions="FillAndExpand"
            VerticalOptions="FillAndExpand"
            x:Name="slider_navbar"
            Grid.Row="0"
            Margin="0"
            Padding="0"
            Grid.Column="0"

            Grid.ColumnSpan="12">

            <!-- NAVBAR -->
            <Grid
                AbsoluteLayout.LayoutBounds="0,0,1,1"
                AbsoluteLayout.LayoutFlags="All"
                ColumnDefinitions="*,*,*"
                HorizontalOptions="FillAndExpand"
                VerticalOptions="FillAndExpand"
                Opacity=".9"
                Margin="0"
                Padding="0">
                <Grid.GestureRecognizers>
                    <TapGestureRecognizer
                        Tapped="SliderUpDown">
                    </TapGestureRecognizer>
                </Grid.GestureRecognizers>


                <!-- POI VIEW POPOVER -->
                <Frame
                    x:Name="slPoiPopover"
                    HorizontalOptions="Fill"
                    VerticalOptions="StartAndExpand"
                    Margin="0"
                    Padding="0">
                    <Grid
                        Padding="0"
                        Margin="0"
                        HorizontalOptions="CenterAndExpand"
                        VerticalOptions="CenterAndExpand"
                        RowDefinitions="1*,.6*,.6*">
                        <!--ColumnDefinitions="auto, auto"-->

                        <Label
                            Grid.Row="0"
                            VerticalOptions="End"
                            HorizontalOptions="CenterAndExpand"
                            FontAttributes="Bold"
                            Text="{Binding Country}"
                            FontSize="18"></Label>
                        <Label
                            VerticalOptions="StartAndExpand"
                            HorizontalOptions="CenterAndExpand"
                            Grid.Row="1"
                            x:Name="lbl_Country"
                            Text="{Binding Area}"
                            FontSize="13"></Label>
                        <Label
                            VerticalOptions="Start"
                            HorizontalOptions="CenterAndExpand"
                            Grid.Row="2"
                            Margin="0"
                            Text="{Binding StreetName}"
                            FontSize="12"></Label>
                        <StackLayout
                            Grid.Row="0"
                            Grid.Column="1"
                            Orientation="Horizontal">
                            <Label
                                VerticalOptions="End"
                                HorizontalOptions="CenterAndExpand"
                                Text="Today"
                                FontSize="13"
                                FontAttributes="Bold" />
                            <Label
                                VerticalOptions="End"
                                HorizontalOptions="CenterAndExpand"
                                Text="Tomorrow"
                                FontSize="13"
                                FontAttributes="Bold" />
                        </StackLayout>

                        <!--WEATHER-->
                        <StackLayout
                            x:Name="sl_Weather"
                            Grid.Row="1"
                            Grid.Column="1"
                            Orientation="Horizontal">
                            <Label
                                VerticalOptions="End"
                                HorizontalOptions="CenterAndExpand"
                                Text="{Binding AvgTempToday, StringFormat='{0}°C'}"
                                FontSize="13" />
                            <Image
                                Source="{Binding AvgIconUriToday}" />
                            <Label
                                VerticalOptions="End"
                                HorizontalOptions="CenterAndExpand"
                                Text="{Binding AvgTempTomorrow, StringFormat='{0}°C'}"
                                FontSize="13" />
                            <Image
                                Source="{Binding AvgIconUriTomorrow}" />
                        </StackLayout>

                    </Grid>
                </Frame>


                <!-- GLOBE ICON -->
                <Grid
                    Grid.Column="1"
                    Grid.Row="0"
                    HorizontalOptions="CenterAndExpand">
                    <Path
                        Fill="#008db3"
                        Data="M58.4,22.7L60,42.7C55.8,54,44.8,62,32,62C15.4,62,2,48.6,2,32S15.4,2,32,2c6,0,11.6,1.8,16.3,4.8L58.4,22.7z" />
                    <Path
                        Fill="#ffc942"
                        Data="m48.3 6.8c.3 1 .6 2.1-.4 1.6-1.7-.9-3.9-1.9-3.2-1.2s1 1.5-.1 1.4c-1.1-.1-3.1-.4-4 .9-.9 1.3-2.1 1-2.4 1.5-.3.5-.8 2.6-1.7 1.9-.9-.6-2.7-2.9-1.2-2.3 1.5.6 3.2-.1 1.8-1.7-1.4-1.6-2.8-1-3.4-1.9-.6-.9-2.6-2-4.1.2-1.4 2.2-2.7 5.1-3.5 5.7-.8.6-2.5 1.7-2.2 2.6.2.9.3 3 1.2 2.4s1.4-.9 1.8-.3c.3.6.2 1.8.9 1.8 0 0 1.4-1 1.5-1.9.1-.9-1-1.4-.2-2.7s2.6-3.8 2.2-2.5c-.4 1.2-1.3 3-.6 3.8.6.8 4.1-.2 2.5.6-1.6.8-2.4 1.4-2.7 2.4-.3 1-.6 1.8-1.4 1.4s-1.8-.2-2.2-.2-.6-1.8-1.3-1.4c-.6.4.2 1.7-.5 1.8-.7.1-.8.9-1.6 1.5-.8.6-1.9 1.8-2.6 1.9s1.1 1 .8 1.8c-.3.9-1.9.8-2.5.9s-.1 1.3-.4 2c-.3.7.3 1.4 1.3 1.4 1 0 2-.2 2.1-1.1.1-.9 1-2.4 1.7-2.1.6.3 2.1-.6 2.4-.1.3.5 2.2 2.2 2 2.4s-1.3.7-.9.9c0 0 .3.5.5.4s.7-1.4 1-1.6.3-.9-.1-1.2c-.5-.3-2.2-1.5-1.8-2.1s1.3.7 1.7 1.1c.4.4 1 .9 1 1.8s.6.9.6 1.3c.1.5.3.6.8.6.5-.1.7-1.2.5-1.5-.3-.3-.3-.9.3-.9.6 0 1.3-.5 1.3-.8 0-.3.6-2.1 1-2.1s.7.7.8 1.1c.2.4 1.2-.3 1-.7-.2-.4.1-.5.4-.5.3 0 .1.8.3 1 .3.2 1.7 1.1 1.2 1.6s-1.2.2-1.7-.2c-.5-.4-1.8-.2-2.2.2-.3.4-.6.6-1.2.6-.6 0-.5 1.1 0 1.5.5.5 1.2.1 1.7.4.5.3 1.3-.4 1.4.1.1.5-.1 2-.6 2.1-.5.1-2.1.4-3.2-.1-1.2-.5-2.3-.7-2.4-.2-.1.6-.1 1-.9.5s-1.5-.8-2-.8c-.5 0-.5-.9-.4-1.6.1-.7-1.2-.5-2-.3s-2.4.7-3.4.7-1.4.2-1.6.6-1.1.4-1.1 1.2c0 .8.1 1-.7 1.4-.9.3-1.1 1.9-1.5 2.3-.4.4.4 1.4 0 2-.4.5-.8 1.9-.1 2.2.7.3 1.4 1.7 1.7 2.2.3.5 1.4 1 2.5.8 1.1-.2 3.1-.8 4.2-.3s2.2.4 1.7 1.4c-.6 1 .3 2.3 1 3 .7.7.5 2.5.1 3-.4.6-.3 1.6.1 2.1.4.5.6 1.7.6 2.1 0 .5.8 1.4.9 2.3.1 1-.6 2.1.3 2.1.9 0 3.2.1 3.4-.3s2-2 2.5-2.7 1.5-1.9 1.2-2.6c-.6-.5-.2-1 .8-1.4 1-.4 1-3.2.5-3.9-.5-.7.4-2.4 1.5-2.9 1.1-.5 3.7-5.1 2.9-4.7-.9.4-2.6.7-3.2.3-.6-.4-4.1-6.4-3.6-6.8s3.3 5.5 3.8 6.2c.5.8 5.2-2.1 5.8-2.8.5-.7-.3-1.4-.6-1.4s-1.4-.7-1.7-.3-2.3-2.9-1.6-2.6c.7.3 2.2 1.3 3.6 2.1s3-.5 3.9 1c1 1.5 1.6.5 1.5 1.2s1.2 3.6 1.7 4.5c.4.9 1.3-.4 1.4-1.4.1-1.1 2.2-2.8 3-3.4.7-.6 2.1.3 2.3 1.5.2 1.2 1.2-.2 1.2.7 0 1-.2 2.3.5 3.5 1.4-3.5 2.1-7 2.1-10.8 0-10.6-5.5-19.9-13.7-25.2" />
                    <Path
                        Data="m16.4 10.6c-.6.2-1.2.9-2 .5-.8-.4-2.5.2-1.4 1.1 1 1 .6 1.6 1.6 1.7s1.6-1.3 2.3-1.2.2-2.3-.5-2.1" />
                    <Path
                        Data="m40.7 49.7c-.7.1-.5 1.5-1.3 1.7-.7.2-.1.8-.5 1.3-.3.5-.5 1.7 0 2.3.5.7.7.7 1.3-.4.6-1 2-5 .5-4.9" />
                    <Path
                        Data="m20.6 17.3c-.3 0-.6.2-.9.2-.3.1-.5.5-.5.9 0 .5.8.6.5.9-.3.3-1.9.6-1.7 1.1s.5.9.2 1.4c-.3.5.3.6.9.4s1-.9.9-1.3c-.1-.5.9-.6.6-.2s-.8 1.4-.5 1.7c.3.3-.8.8-.4 1 .4.2 1.5-.8 2.1-.6s.8-.2.9-.7c.1-.6-.8-1.3-1.1-2-.3-.8-.1-2.8-1-2.8" />

                </Grid>
                <!-- ICON TEXT -->
                <StackLayout
                    Grid.Column="1"
                    Orientation="Vertical"
                    HorizontalOptions="CenterAndExpand">
                    <Label
                        HorizontalOptions="Center"
                        HeightRequest="50"
                        Text="PuMap"
                        FontSize="40"
                        FontFamily="Lobster-Regular"></Label>
                    <Label
                        HorizontalOptions="Center"
                        Margin="-10"
                        Text="Travel for the people by the people"
                        FontSize="12"
                        FontFamily="Lobster-Regular"></Label>
                </StackLayout>

                <!--<<<<<<<< Navbar Login/Signup buttons >>>>>>>-->
                <StackLayout
                    Grid.Column="2"
                    HorizontalOptions="EndAndExpand"
                    Orientation="Horizontal"
                    Margin="0">

                    <Grid
                HorizontalOptions="CenterAndExpand"
                WidthRequest="500"
                ColumnDefinitions="auto,auto">
                        <ffimageloadingsvg:SvgCachedImage
                    Grid.Column="2"
                    VerticalOptions="Center"
                    HorizontalOptions="End"
                    HeightRequest="50"
                    WidthRequest="50"
                    Margin="0,0,0,0"
                    Source="resource://Puma.Resources.SettingsIcon.svg">
                        </ffimageloadingsvg:SvgCachedImage>

                        <!--- SETTINGS IMAGE BUTTON-->
                        <local:CustomButton
                    HorizontalOptions="End"
                    x:Name="btn_Settings_Popup"
                    ClassId="settingsPopup"
                    BackgroundColor="LightBlue"
                    Grid.Column="2"
                    
                    Opacity="0"
                    Text="Settings"
                    Command="{Binding OpenSettingsCommand}"
                    Clicked="btn_OpenSettings">
                        </local:CustomButton>
                    </Grid>

                    <Label
                        IsVisible="{Binding userLogoutState}"
                        TextColor="{AppThemeBinding Dark={StaticResource TextColorDark}, Light={StaticResource TextColor}}"
                        Text="|"
                        VerticalOptions="Center" />
                    <Label
                        IsVisible="{Binding userLoginState}"
                        TextColor="{AppThemeBinding Dark={StaticResource TextColorDark}, Light={StaticResource TextColor}}"
                        Text="|"
                        VerticalOptions="Center"></Label>
                    <local:CustomButton
                        x:Name="btn_Login_Popup"
                        CornerRadius="15"
                        ClassId="loginPopup"
                        Command="{Binding OpenLoginCommand}"
                        IsVisible="{Binding userLoginState}"
                        TextColor="{AppThemeBinding Dark={StaticResource TextColorDark}, Light={StaticResource TextColor}}"
                        BorderColor="{AppThemeBinding Dark={StaticResource BorderColorDark}, Light={StaticResource BorderColor}}"
                        Text="Log in" />
                    <local:CustomButton
                        x:Name="btn_Logout"
                        Command="{Binding LogOutCommand}"
                        IsVisible="{Binding userLogoutState}"
                        TextColor="{AppThemeBinding Dark={StaticResource TextColorDark}, Light={StaticResource TextColor}}"
                        BorderColor="{AppThemeBinding Dark={StaticResource BorderColorDark}, Light={StaticResource BorderColor}}"
                        Text="Log out" />
                </StackLayout>
            </Grid>



            <!--  MENU -->
            <StackLayout
                BackgroundColor="yellow"
                Opacity=".5"
                IsVisible="false"
                x:Name="slider_menu"
                HorizontalOptions="Fill"
                VerticalOptions="Fill">
                <ContentView
                    BackgroundColor="{AppThemeBinding Dark={StaticResource PopUpBackgroundColorDark},
                    Light={StaticResource PopUpBackgroundColor}}"
                    Opacity="0.8" />

                <!-- POI MENU BUTTONS -->
                <StackLayout
                    x:Name="slPoiMenuButtons"
                    Padding="0"
                    Margin="0"
                    Orientation="Horizontal"
                    VerticalOptions="Fill"
                    HorizontalOptions="FillAndExpand">

                    <local:CustomButton
                        BackgroundColor="{AppThemeBinding Dark={StaticResource PopUpBackgroundColorDark}, Light={StaticResource PopUpBackgroundColor}}"
                        Command="{Binding PoiGetCollectionCommand}"
                        Clicked="slider_MenuButtonClicked"
                        ClassId="poiCollectionFrame"
                        Grid.Column="0"
                        HorizontalOptions="FillAndExpand"
                        Text="Points of Interest">
                    </local:CustomButton>
                    <local:CustomButton
                        BackgroundColor="{AppThemeBinding Dark={StaticResource PopUpBackgroundColorDark}, Light={StaticResource PopUpBackgroundColor}}"
                        Grid.Column="1"
                        HorizontalOptions="FillAndExpand"
                        Command="{Binding WeatherPopupCommand}"
                        ClassId="weatherCollectionView"
                        Clicked="slider_MenuButtonClicked"
                        Text="Weather"></local:CustomButton>
                    <local:CustomButton
                        BackgroundColor="{AppThemeBinding Dark={StaticResource PopUpBackgroundColorDark}, Light={StaticResource PopUpBackgroundColor}}"
                        Grid.Row="0"
                        Grid.Column="2"
                        HorizontalOptions="FillAndExpand"
                        ClassId="poiCreationView"
                        Clicked="slider_MenuButtonClicked"
                        Text="Add new Point of Interest"></local:CustomButton>
                </StackLayout>

                <!-- POI CREATION POPUP -->
                <Frame
                    IsVisible="false"
                    HorizontalOptions="StartAndExpand"
                    VerticalOptions="StartAndExpand"
                    Background="White"
                    x:Name="poiCreationView"
                    ClassId="poiCreationView"
                    Opacity=".9">
                    <ScrollView>
                        <StackLayout
                            x:Name="slPoiPopup">
                            <local:RoundedEntry
                                x:Name="entry_Name"
                                Text="{Binding Name}"
                                FontSize="24"
                                Margin="0,0,0,10"
                                Placeholder="Name of Location.."></local:RoundedEntry>
                            <local:CustomEditor
                                x:Name="entry_Description"
                                Text="{Binding Description}"
                                HeightRequest="250"
                                VerticalOptions="Center"
                                FontSize="24"
                                Placeholder="Description.."></local:CustomEditor>


                            <StackLayout
                                HeightRequest="50">
                                <CollectionView
                                    x:Name="cwTags"
                                    HorizontalOptions="Center"
                                    Margin="0"
                                    ItemsLayout="HorizontalList"
                                    SelectionMode="Single"
                                    ItemsSource="{Binding TagButtons}">

                                    <CollectionView.ItemTemplate>

                                        <DataTemplate>

                                            <local:CustomButton
                                                Command="{Binding Path=BindingContext.RemoveTagCommand, Source={x:Reference Name=cwTags}}"
                                                CommandParameter="{Binding}"
                                                Margin="10"
                                                WidthRequest="100"
                                                HorizontalOptions="FillAndExpand"
                                                VerticalOptions="FillAndExpand"
                                                Text="{Binding Name, StringFormat='X    {0:F0}'}"
                                                FontSize="12">

                                            </local:CustomButton>

                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                            </StackLayout>
                            <!--<local:CustomButton Text="{Binding SelectedTagInfo.Name}" FontSize="12"/>-->
                            <Picker
                                x:Name="TagPicker"
                                SelectedItem="{Binding SelectedTagInfo}"
                                ItemsSource="{Binding Tags}"
                                ItemDisplayBinding="{Binding Name}" />
                            <local:RoundedEntry
                                x:Name="entry_address"
                                Text="{Binding StreetName}"></local:RoundedEntry>
                            <local:RoundedEntry
                                x:Name="entry_zip"
                                Text="{Binding Area}"></local:RoundedEntry>
                            <local:RoundedEntry
                                x:Name="entry_country"
                                Text="{Binding Country}"></local:RoundedEntry>
                            <local:CustomButton
                                Text="Add Point of Interest"
                                Command="{Binding CreatePoiCommand}" />
                            <local:RoundedEntry
                                IsVisible="false"
                                x:Name="lbl_latitude"
                                Text="{Binding Latitude}"
                                FontSize="12"></local:RoundedEntry>
                            <local:RoundedEntry
                                IsVisible="false"
                                x:Name="lbl_longitude"
                                Text="{Binding Longitude}"
                                FontSize="12"></local:RoundedEntry>
                            <Label
                                x:Name="lbl_adress"
                                FontSize="8"></Label>
                        </StackLayout>
                    </ScrollView>
                </Frame>


                <!-- POI COLLECTION VIEW  >-->
                <Frame
                    HorizontalOptions="FillAndExpand"
                    VerticalOptions="FillAndExpand"
                    IsVisible="true"
                    Margin="10,10"
                    BackgroundColor="White"
                    Opacity=".9"
                    ClassId="poiCollectionFrame"
                    x:Name="poiCollectionFrame">
                    <!-- SINGLE POI -->
                    <StackLayout>
                        <StackLayout
                            x:Name="poiSingleView"
                            IsVisible="{Binding PoiSingleVisible}">
                            <local:CustomButton
                                Text="Return"
                                Command="{Binding PoiCollectionViewCommand}" />
                            <Label
                                FontSize="32"
                                FontAttributes="Bold"
                                TextDecorations="Underline"
                                Text="{Binding SelectedSinglePoi.Name}" />
                            <Label
                                FontSize="12"
                                Text="{Binding SelectedSinglePoi.Address.Country}" />
                            <Label
                                FontSize="12"
                                Text="{Binding SelectedSinglePoi.Address.Area}" />
                            <Label
                                FontSize="12"
                                Text="{Binding SelectedSinglePoi.Address.StreetName}" />
                            <Label
                                FontSize="12"
                                Text="{Binding SelectedSinglePoi.Description}" />
                        </StackLayout>
                        <!-- POI COLLECTION -->
                        <StackLayout
                            IsVisible="{Binding PoiCollectionVisible}">
                            <CollectionView
                                x:Name="poiCollectionView"
                                Margin="0"
                                ItemsSource="{Binding PoiCollection}"
                                SelectionMode="Single"
                                SelectedItem="{Binding SelectedSinglePoi}"
                                SelectionChangedCommand="{Binding PoiSingleViewCommand}">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid
                                            Padding="5"
                                            HeightRequest="60"
                                            RowDefinitions="1*,1*,1*">
                                            <Label
                                                Grid.Row="0"
                                                Text="{Binding Name}"
                                                FontAttributes="Bold"
                                                CharacterSpacing=".5"
                                                FontSize="12"
                                                HeightRequest="100"></Label>
                                            <Label
                                                Grid.Row="1"
                                                Text="{Binding Description}"
                                                FontSize="12"
                                                HeightRequest="100"></Label>
                                            <Label
                                                Grid.Row="2"
                                                FontSize="12"
                                                FontAttributes="Italic"
                                                HeightRequest="100">
                                                <Label.Text>
                                                    <MultiBinding
                                                        StringFormat="{}{0}, {1}">
                                                        <Binding
                                                            Path="Address.Area" />
                                                        <Binding
                                                            Path="Address.Country" />
                                                    </MultiBinding>
                                                </Label.Text>
                                            </Label>
                                            <Rectangle
                                                Grid.Row="2"
                                                HeightRequest="1"
                                                BackgroundColor="Black"
                                                VerticalOptions="End"
                                                HorizontalOptions="FillAndExpand" />
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </StackLayout>
                    </StackLayout>
                </Frame>



                <!-- WEATHER POPUP -->
                <Frame
                    Grid.Row="2"
                    Grid.RowSpan="8"
                    Grid.ColumnSpan="12"
                    HorizontalOptions="StartAndExpand"
                    VerticalOptions="StartAndExpand"
                    Margin="10,10"
                    IsVisible="false"
                    ClassId="weatherCollectionView"
                    BackgroundColor="#005AC7"
                    Opacity="0.9"
                    x:Name="weatherCollectionView">


                    <CollectionView
                        IsVisible="true"
                        VerticalOptions="StartAndExpand"
                        HorizontalOptions="Center"
                        Margin="0"
                        ItemsSource="{Binding ForecastCollection}"
                        SelectionMode="Single"
                        IsGrouped="True">
                        <CollectionView.GroupHeaderTemplate>
                            <DataTemplate>
                                <Frame
                                    HorizontalOptions="CenterAndExpand"
                                    VerticalOptions="Center"
                                    BackgroundColor="{AppThemeBinding 
                              Dark={StaticResource WindowBackgroundColorDark}, 
                              Light={StaticResource WindowBackgroundColor}}"
                                    Padding="0,2"
                                    CornerRadius="5">

                                    <Label
                                        Text="{Binding Key, StringFormat='{0:dddd, MMMM dd, yyyy}'}"
                                        FontSize="20"
                                        TextColor="Black"
                                        HorizontalTextAlignment="Center" />
                                </Frame>
                            </DataTemplate>
                        </CollectionView.GroupHeaderTemplate>
                        <CollectionView.ItemTemplate>


                            <DataTemplate>
                                <Grid
                                    HeightRequest="50"
                                    HorizontalOptions="FillAndExpand"
                                    VerticalOptions="FillAndExpand">

                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition
                                            Width="*" />
                                        <ColumnDefinition
                                            Width="*" />
                                        <ColumnDefinition
                                            Width="*" />
                                        <ColumnDefinition
                                            Width="*" />
                                        <ColumnDefinition
                                            Width="2*" />
                                    </Grid.ColumnDefinitions>

                                    <StackLayout
                                        VerticalOptions="CenterAndExpand"
                                        HorizontalOptions="Center"
                                        Grid.Column="1"
                                        Grid.ColumnSpan="2">
                                        <Label
                                            Text="{Binding DateTime, StringFormat='{0:HH:mm}'}"
                                            TextColor="White"
                                            FontSize="18"
                                            VerticalOptions="Center"
                                            Margin="20,0" />
                                    </StackLayout>
                                    <StackLayout
                                        HorizontalOptions="EndAndExpand"
                                        VerticalOptions="CenterAndExpand"
                                        Grid.Column="2">
                                        <Image
                                            Source="{Binding IconUrl}"
                                            WidthRequest="38"
                                            HeightRequest="38"
                                            HorizontalOptions="CenterAndExpand"
                                            VerticalOptions="Center" />
                                    </StackLayout>



                                    <StackLayout
                                        Grid.Column="3"
                                        VerticalOptions="CenterAndExpand"
                                        Orientation="Horizontal"
                                        HorizontalOptions="EndAndExpand">
                                        <Label
                                            Text="{Binding Temperature, StringFormat='{0}°C'}"
                                            BindingContextChanged="LblTemperature_BindingContextChanged"
                                            TextColor="Black"
                                            FontSize="20"
                                            FontAttributes="Bold"
                                            VerticalOptions="Center" />

                                    </StackLayout>
                                </Grid>
                            </DataTemplate>

                        </CollectionView.ItemTemplate>

                    </CollectionView>
                </Frame>


            </StackLayout>
            <!-- NAVBAR -->
            <Grid
                AbsoluteLayout.LayoutBounds="0,0,1,1"
                AbsoluteLayout.LayoutFlags="All"
                RowDefinitions="*,*,*"
                HorizontalOptions="FillAndExpand"
                VerticalOptions="FillAndExpand"
                Opacity=".9"
                Margin="0"
                Padding="0">
                <Grid.GestureRecognizers>
                    <TapGestureRecognizer
                        Tapped="SliderUpDown">
                    </TapGestureRecognizer>
                </Grid.GestureRecognizers>


                <!-- POI VIEW POPOVER -->
                <Frame
                    x:Name="slPoiPopover"
                    HorizontalOptions="Fill"
                    VerticalOptions="StartAndExpand"
                    Margin="0"
                    Padding="0">
                    <Grid
                        Padding="0"
                        Margin="0"
                        HorizontalOptions="CenterAndExpand"
                        VerticalOptions="CenterAndExpand"
                        RowDefinitions="1*,.6*,.6*">
                        <!--ColumnDefinitions="auto, auto"-->

                        <Label
                            Grid.Row="0"
                            VerticalOptions="End"
                            HorizontalOptions="CenterAndExpand"
                            FontAttributes="Bold"
                            Text="{Binding Country}"
                            FontSize="18"></Label>
                        <Label
                            VerticalOptions="StartAndExpand"
                            HorizontalOptions="CenterAndExpand"
                            Grid.Row="1"
                            x:Name="lbl_Country"
                            Text="{Binding Area}"
                            FontSize="13"></Label>
                        <Label
                            VerticalOptions="Start"
                            HorizontalOptions="CenterAndExpand"
                            Grid.Row="2"
                            Margin="0"
                            Text="{Binding StreetName}"
                            FontSize="12"></Label>
                        <StackLayout
                            Grid.Row="0"
                            Grid.Column="1"
                            Orientation="Horizontal">
                            <Label
                                VerticalOptions="End"
                                HorizontalOptions="CenterAndExpand"
                                Text="Today"
                                FontSize="13"
                                FontAttributes="Bold" />
                            <Label
                                VerticalOptions="End"
                                HorizontalOptions="CenterAndExpand"
                                Text="Tomorrow"
                                FontSize="13"
                                FontAttributes="Bold" />
                        </StackLayout>

                        <!--WEATHER-->
                        <StackLayout
                            x:Name="sl_Weather"
                            Grid.Row="1"
                            Grid.Column="1"
                            Orientation="Horizontal">
                            <Label
                                VerticalOptions="End"
                                HorizontalOptions="CenterAndExpand"
                                Text="{Binding AvgTempToday, StringFormat='{0}°C'}"
                                FontSize="13" />
                            <Image
                                Source="{Binding AvgIconUriToday}" />
                            <Label
                                VerticalOptions="End"
                                HorizontalOptions="CenterAndExpand"
                                Text="{Binding AvgTempTomorrow, StringFormat='{0}°C'}"
                                FontSize="13" />
                            <Image
                                Source="{Binding AvgIconUriTomorrow}" />
                        </StackLayout>

                    </Grid>
                </Frame>


                <!-- GLOBE ICON -->
                <Grid
                    Grid.ColumnSpan="2"
                    Grid.Row="1"
                    HorizontalOptions="FillAndExpand">
                    <Path
                        Fill="#008db3"
                        Data="M58.4,22.7L60,42.7C55.8,54,44.8,62,32,62C15.4,62,2,48.6,2,32S15.4,2,32,2c6,0,11.6,1.8,16.3,4.8L58.4,22.7z" />
                    <Path
                        Fill="#ffc942"
                        Data="m48.3 6.8c.3 1 .6 2.1-.4 1.6-1.7-.9-3.9-1.9-3.2-1.2s1 1.5-.1 1.4c-1.1-.1-3.1-.4-4 .9-.9 1.3-2.1 1-2.4 1.5-.3.5-.8 2.6-1.7 1.9-.9-.6-2.7-2.9-1.2-2.3 1.5.6 3.2-.1 1.8-1.7-1.4-1.6-2.8-1-3.4-1.9-.6-.9-2.6-2-4.1.2-1.4 2.2-2.7 5.1-3.5 5.7-.8.6-2.5 1.7-2.2 2.6.2.9.3 3 1.2 2.4s1.4-.9 1.8-.3c.3.6.2 1.8.9 1.8 0 0 1.4-1 1.5-1.9.1-.9-1-1.4-.2-2.7s2.6-3.8 2.2-2.5c-.4 1.2-1.3 3-.6 3.8.6.8 4.1-.2 2.5.6-1.6.8-2.4 1.4-2.7 2.4-.3 1-.6 1.8-1.4 1.4s-1.8-.2-2.2-.2-.6-1.8-1.3-1.4c-.6.4.2 1.7-.5 1.8-.7.1-.8.9-1.6 1.5-.8.6-1.9 1.8-2.6 1.9s1.1 1 .8 1.8c-.3.9-1.9.8-2.5.9s-.1 1.3-.4 2c-.3.7.3 1.4 1.3 1.4 1 0 2-.2 2.1-1.1.1-.9 1-2.4 1.7-2.1.6.3 2.1-.6 2.4-.1.3.5 2.2 2.2 2 2.4s-1.3.7-.9.9c0 0 .3.5.5.4s.7-1.4 1-1.6.3-.9-.1-1.2c-.5-.3-2.2-1.5-1.8-2.1s1.3.7 1.7 1.1c.4.4 1 .9 1 1.8s.6.9.6 1.3c.1.5.3.6.8.6.5-.1.7-1.2.5-1.5-.3-.3-.3-.9.3-.9.6 0 1.3-.5 1.3-.8 0-.3.6-2.1 1-2.1s.7.7.8 1.1c.2.4 1.2-.3 1-.7-.2-.4.1-.5.4-.5.3 0 .1.8.3 1 .3.2 1.7 1.1 1.2 1.6s-1.2.2-1.7-.2c-.5-.4-1.8-.2-2.2.2-.3.4-.6.6-1.2.6-.6 0-.5 1.1 0 1.5.5.5 1.2.1 1.7.4.5.3 1.3-.4 1.4.1.1.5-.1 2-.6 2.1-.5.1-2.1.4-3.2-.1-1.2-.5-2.3-.7-2.4-.2-.1.6-.1 1-.9.5s-1.5-.8-2-.8c-.5 0-.5-.9-.4-1.6.1-.7-1.2-.5-2-.3s-2.4.7-3.4.7-1.4.2-1.6.6-1.1.4-1.1 1.2c0 .8.1 1-.7 1.4-.9.3-1.1 1.9-1.5 2.3-.4.4.4 1.4 0 2-.4.5-.8 1.9-.1 2.2.7.3 1.4 1.7 1.7 2.2.3.5 1.4 1 2.5.8 1.1-.2 3.1-.8 4.2-.3s2.2.4 1.7 1.4c-.6 1 .3 2.3 1 3 .7.7.5 2.5.1 3-.4.6-.3 1.6.1 2.1.4.5.6 1.7.6 2.1 0 .5.8 1.4.9 2.3.1 1-.6 2.1.3 2.1.9 0 3.2.1 3.4-.3s2-2 2.5-2.7 1.5-1.9 1.2-2.6c-.6-.5-.2-1 .8-1.4 1-.4 1-3.2.5-3.9-.5-.7.4-2.4 1.5-2.9 1.1-.5 3.7-5.1 2.9-4.7-.9.4-2.6.7-3.2.3-.6-.4-4.1-6.4-3.6-6.8s3.3 5.5 3.8 6.2c.5.8 5.2-2.1 5.8-2.8.5-.7-.3-1.4-.6-1.4s-1.4-.7-1.7-.3-2.3-2.9-1.6-2.6c.7.3 2.2 1.3 3.6 2.1s3-.5 3.9 1c1 1.5 1.6.5 1.5 1.2s1.2 3.6 1.7 4.5c.4.9 1.3-.4 1.4-1.4.1-1.1 2.2-2.8 3-3.4.7-.6 2.1.3 2.3 1.5.2 1.2 1.2-.2 1.2.7 0 1-.2 2.3.5 3.5 1.4-3.5 2.1-7 2.1-10.8 0-10.6-5.5-19.9-13.7-25.2" />
                    <Path
                        Data="m16.4 10.6c-.6.2-1.2.9-2 .5-.8-.4-2.5.2-1.4 1.1 1 1 .6 1.6 1.6 1.7s1.6-1.3 2.3-1.2.2-2.3-.5-2.1" />
                    <Path
                        Data="m40.7 49.7c-.7.1-.5 1.5-1.3 1.7-.7.2-.1.8-.5 1.3-.3.5-.5 1.7 0 2.3.5.7.7.7 1.3-.4.6-1 2-5 .5-4.9" />
                    <Path
                        Data="m20.6 17.3c-.3 0-.6.2-.9.2-.3.1-.5.5-.5.9 0 .5.8.6.5.9-.3.3-1.9.6-1.7 1.1s.5.9.2 1.4c-.3.5.3.6.9.4s1-.9.9-1.3c-.1-.5.9-.6.6-.2s-.8 1.4-.5 1.7c.3.3-.8.8-.4 1 .4.2 1.5-.8 2.1-.6s.8-.2.9-.7c.1-.6-.8-1.3-1.1-2-.3-.8-.1-2.8-1-2.8" />

                </Grid>
                <!-- ICON TEXT -->
                <StackLayout
                    Grid.Row="1"
                    Orientation="Vertical"
                    HorizontalOptions="CenterAndExpand">
                    <Label
                        HorizontalOptions="Center"
                        HeightRequest="50"
                        Text="PuMap"
                        FontSize="40"
                        FontFamily="Lobster-Regular"></Label>
                    <Label
                        HorizontalOptions="Center"
                        Margin="-10"
                        Text="Travel for the people by the people"
                        FontSize="12"
                        FontFamily="Lobster-Regular"></Label>
                </StackLayout>

                <!--<<<<<<<< Navbar Login/Signup buttons >>>>>>>-->
                <StackLayout
                    BackgroundColor="red"
                    Grid.ColumnSpan="2"
                    VerticalOptions="FillAndExpand"
                    HorizontalOptions="FillAndExpand"
                    Margin="0">

                    <Grid
                        Grid.Row="0"
                        VerticalOptions="FillAndExpand"
                HorizontalOptions="FillAndExpand"
                RowDefinitions="auto,auto">
                        <ffimageloadingsvg:SvgCachedImage
                    Grid.Row="1"
                    VerticalOptions="Center"
                    HorizontalOptions="End"
                    HeightRequest="50"
                    WidthRequest="50"
                    Margin="0,0,0,0"
                    Source="resource://Puma.Resources.SettingsIcon.svg">
                        </ffimageloadingsvg:SvgCachedImage>

                        <!--- SETTINGS IMAGE BUTTON-->
                        <local:CustomButton
                    x:Name="btn_Settings_Popup"
                    ClassId="settingsPopup"
                    BackgroundColor="LightBlue"
                    Grid.Row="1"
                    
                    Opacity="0"
                    Text="Settings"
                    Command="{Binding OpenSettingsCommand}"
                    Clicked="btn_OpenSettings">
                        </local:CustomButton>
                    </Grid>
<!--
                    <Button
                        x:Name="btn_Settings_Popup"
                        ImageSource="resource://Puma.Resources.SettingsIcon.svg"
                        HeightRequest="50"
                        WidthRequest="50"
                        CornerRadius="15"
                        Margin="0,0,20,0"
                        ClassId="settingsPopup"
                        Command="{Binding OpenSettingsCommand}"
                        Clicked="btn_OpenSettings"
                        TextColor="{AppThemeBinding Dark={StaticResource TextColorDark}, Light={StaticResource TextColor}}"
                        BorderColor="{AppThemeBinding Dark={StaticResource BorderColorDark}, Light={StaticResource BorderColor}}"
                        Text="Settings">
                    </Button>
                        <ffimageloadingsvg:SvgCachedImage
                    Grid.Column="2"
                    VerticalOptions="Center"
                    HorizontalOptions="End"
                    HeightRequest="50"
                    WidthRequest="50"
                    Margin="0,0,0,0"
                    Source="resource://Puma.Resources.SettingsIcon.svg">
                    </ffimageloadingsvg:SvgCachedImage> -->
                    <StackLayout Grid.Row="1">
                    <Label
                        IsVisible="{Binding userLogoutState}"
                        TextColor="{AppThemeBinding Dark={StaticResource TextColorDark}, Light={StaticResource TextColor}}"
                        Text="|"
                        VerticalOptions="Center" />
                    <Label
                        IsVisible="{Binding userLoginState}"
                        TextColor="{AppThemeBinding Dark={StaticResource TextColorDark}, Light={StaticResource TextColor}}"
                        Text="|"
                        VerticalOptions="Center"></Label>
                    <local:CustomButton
                        x:Name="btn_Login_Popup"
                        CornerRadius="15"
                        ClassId="loginPopup"
                        Command="{Binding OpenLoginCommand}"
                        IsVisible="{Binding userLoginState}"
                        TextColor="{AppThemeBinding Dark={StaticResource TextColorDark}, Light={StaticResource TextColor}}"
                        BorderColor="{AppThemeBinding Dark={StaticResource BorderColorDark}, Light={StaticResource BorderColor}}"
                        Text="Log in" />
                    <local:CustomButton
                        x:Name="btn_Logout"
                        Command="{Binding LogOutCommand}"
                        IsVisible="{Binding userLogoutState}"
                        TextColor="{AppThemeBinding Dark={StaticResource TextColorDark}, Light={StaticResource TextColor}}"
                        BorderColor="{AppThemeBinding Dark={StaticResource BorderColorDark}, Light={StaticResource BorderColor}}"
                        Text="Log out" />
                    </StackLayout>
                </StackLayout>
            </Grid>


            
        </AbsoluteLayout>


        <!--Signup Popup "-->

        <Frame
            IsVisible="{Binding signupPopupState}"
            x:Name="signupPopup"
            Grid.Row="2"
            Grid.RowSpan="8"
            Grid.ColumnSpan="12"
            WidthRequest="400"
            HorizontalOptions="CenterAndExpand"
            VerticalOptions="StartAndExpand"
            HeightRequest="500"
            BackgroundColor="{AppThemeBinding 
                              Dark={StaticResource PopUpBackgroundColorDark}, 
                              Light={StaticResource PopUpBackgroundColor}}"
            BorderColor="{AppThemeBinding Dark={StaticResource BorderColorDark}, Light={StaticResource BorderColor}}"
            Opacity=".9">

            <!-- CLOSE POPUP / SIGNUP / LOGIN BUTTONS-->
            <Grid
                RowDefinitions="auto,.9*">
                <Grid
                    Grid.Row="0"
                    ColumnDefinitions="1*,1*,.2*"
                    RowDefinitions="auto,auto">
                    <local:CustomButton
                        Grid.Column="2"
                        Grid.Row="0"
                        VerticalOptions="StartAndExpand"
                        Margin="-10,-10,-10,0"
                        Command="{Binding ClosePopupCommand}"
                        CornerRadius="15"
                        BackgroundColor="{AppThemeBinding 
                                  Dark={StaticResource ButtonBackgroundColorDark}, 
                                  Light={StaticResource ButtonBackgroundColor}}"
                        BorderColor="{AppThemeBinding Dark={StaticResource BorderColorDark}, Light={StaticResource BorderColor}}"
                        Text="X"
                        HorizontalOptions="EndAndExpand" />

                    <Grid
                        Grid.Row="0"
                        Grid.ColumnSpan="2">
                        <local:CustomButton
                            Command="{Binding OpenLoginCommand}"
                            CornerRadius="5"
                            Text="Log in"
                            FontSize="32"
                            Background="#55FFFFFF"
                            BorderColor="Transparent"
                            TextColor="{AppThemeBinding Dark={StaticResource TextColorDark}, Light={StaticResource TextColor}}">

                        </local:CustomButton>
                        <local:CustomButton
                            Grid.Column="1"
                            HorizontalOptions="FillAndExpand"
                            Command="{Binding OpenSignupCommand}"
                            CornerRadius="5"
                            Background="#77FFFFFF"
                            BorderColor="Transparent"
                            TextColor="{AppThemeBinding Dark={StaticResource TextColorDark}, Light={StaticResource TextColor}}"
                            Text="Sign up"
                            FontSize="32"></local:CustomButton>
                        <Rectangle
                            Grid.Row="0"
                            Grid.Column="1"
                            HeightRequest="2"
                            HorizontalOptions="FillAndExpand"
                            VerticalOptions="End"
                            Background="black" />
                    </Grid>
                </Grid>


                <!-- SIGNUP INPUTS -->
                <ScrollView
                    Grid.Row="1">
                    <Grid
                        RowDefinitions="auto,auto,auto,auto,auto,auto,auto,auto,auto,auto"
                        ColumnSpacing="0"
                        x:Name="slCreateUserViewModel">

                        <Label
                            HeightRequest="13"
                            Grid.Row="0"
                            Margin="0"
                            Padding="0"
                            FontSize="13"
                            HorizontalTextAlignment="Center"
                            Text="{Binding EmailErrorMSG}"
                            TextColor="#C3FF0000" />
                        <control:EntryViewControl
                            Grid.Row="1"
                            EntryText="{Binding SignupEmail, Mode=TwoWay}"
                            PlaceholderText="Email"
                            ControlTemplate="{StaticResource EntryViewControlTemplate}" />


                        <Label
                            Grid.Row="2"
                            Margin="0"
                            Padding="0"
                            HeightRequest="12"
                            FontSize="12"
                            VerticalOptions="Start"
                            HorizontalTextAlignment="Center"
                            Text="{Binding PaaswordErrorMSG}"
                            TextColor="#C3FF0000" />
                        <control:EntryViewControl
                            Grid.Row="3"
                            IsPassword="True"
                            EntryText="{Binding SignupPassword, Mode=TwoWay}"
                            PlaceholderText="Password"
                            ControlTemplate="{StaticResource EntryViewControlTemplate}" />


                        <Label
                            Grid.Row="4"
                            Margin="0"
                            Padding="0"
                            FontSize="13"
                            HorizontalTextAlignment="Center"
                            Text="{Binding DisplayNameErrorMSG}"
                            TextColor="#C3FF0000" />
                        <control:EntryViewControl
                            Grid.Row="5"
                            EntryText="{Binding SignupDisplayName, Mode=TwoWay}"
                            PlaceholderText="Display Name"
                            ControlTemplate="{StaticResource EntryViewControlTemplate}" />


                        <Label
                            Grid.Row="6"></Label>
                        <control:EntryViewControl
                            Grid.Row="7"
                            EntryText="{Binding SignupFirstName, Mode=TwoWay}"
                            PlaceholderText="First name"
                            ControlTemplate="{StaticResource EntryViewControlTemplate}" />


                        <Label
                            Grid.Row="8"></Label>
                        <control:EntryViewControl
                            Grid.Row="9"
                            EntryText="{Binding SignupSurname, Mode=TwoWay}"
                            PlaceholderText="Surname"
                            ControlTemplate="{StaticResource EntryViewControlTemplate}" />


                        <local:CustomButton
                            HeightRequest="50"
                            WidthRequest="150"
                            VerticalOptions="Center"
                            Grid.Row="10"
                            Command="{Binding CreateUserCommand}"
                            CornerRadius="10"
                            BorderColor="{AppThemeBinding Dark={StaticResource BorderColorDark}, Light={StaticResource BorderColor}}"
                            HorizontalOptions="Center"
                            BackgroundColor="{AppThemeBinding Dark={StaticResource ButtonBackgroundColorDark}, Light={StaticResource ButtonBackgroundColor}}"
                            TextColor="{AppThemeBinding Dark={StaticResource TextColorDark}, Light={StaticResource TextColor}}"
                            Text="Sign up"
                            FontSize="20">
                        </local:CustomButton>
                    </Grid>
                </ScrollView>
            </Grid>
        </Frame>


        <!-- LOG IN POPUP -->

        <Frame
            x:Name="loginPopup"
            ClassId="loginPopup"
            IsVisible="{Binding loginPopupState}"
            Grid.Row="2"
            Grid.RowSpan="8"
            Grid.ColumnSpan="12"
            WidthRequest="400"
            HorizontalOptions="CenterAndExpand"
            VerticalOptions="StartAndExpand"
            BackgroundColor="{AppThemeBinding Dark={StaticResource PopUpBackgroundColorDark}, Light={StaticResource PopUpBackgroundColor}}"
            Opacity=".9">

            <!-- CLOSE POPUP / LOGIN / SIGNUP BUTTONS -->
            <Grid
                RowDefinitions="auto,.9*">

                <Grid
                    Grid.Row="0"
                    ColumnDefinitions="1*,1*,.2*"
                    RowDefinitions="auto,auto">
                    <local:CustomButton
                        Grid.Column="2"
                        Grid.Row="0"
                        VerticalOptions="StartAndExpand"
                        Margin="-10,-10,-10,0"
                        Command="{Binding ClosePopupCommand}"
                        CornerRadius="15"
                        BackgroundColor="{AppThemeBinding 
                                  Dark={StaticResource ButtonBackgroundColorDark}, 
                                  Light={StaticResource ButtonBackgroundColor}}"
                        BorderColor="{AppThemeBinding Dark={StaticResource BorderColorDark}, Light={StaticResource BorderColor}}"
                        Text="X"
                        HorizontalOptions="EndAndExpand" />

                    <Grid
                        Grid.Row="0"
                        Grid.ColumnSpan="2">
                        <local:CustomButton
                            x:Name="btn_loginBtn"
                            Command="{Binding OpenLoginCommand}"
                            CornerRadius="5"
                            Text="Log in"
                            FontSize="32"
                            Background="#77FFFFFF"
                            BorderColor="Transparent"
                            TextColor="{AppThemeBinding Dark={StaticResource TextColorDark}, Light={StaticResource TextColor}}">
                        </local:CustomButton>
                        <local:CustomButton
                            Grid.Column="1"
                            HorizontalOptions="FillAndExpand"
                            Command="{Binding OpenSignupCommand}"
                            CornerRadius="5"
                            Background="#77FFFFFF"
                            BorderColor="Transparent"
                            TextColor="{AppThemeBinding Dark={StaticResource TextColorDark}, Light={StaticResource TextColor}}"
                            Text="Sign up"
                            FontSize="32"></local:CustomButton>
                        <Rectangle
                            Grid.Row="0"
                            Grid.Column="0"
                            HeightRequest="2"
                            HorizontalOptions="FillAndExpand"
                            VerticalOptions="End"
                            Background="black" />
                    </Grid>

                </Grid>


                <!-- LOGIN INPUTS -->
                <ScrollView
                    Grid.Row="1">
                    <Grid
                        RowDefinitions="auto,auto,auto"
                        x:Name="slLogIn">
                        <control:EntryViewControl
                            Grid.Row="0"
                            EntryText="{Binding LoginEmail, Mode=TwoWay}"
                            PlaceholderText="Email"
                            ControlTemplate="{StaticResource EntryViewControlTemplate}" />
                        <control:EntryViewControl
                            Grid.Row="1"
                            IsPassword="True"
                            EntryText="{Binding LoginPassword, Mode=TwoWay}"
                            PlaceholderText="Password"
                            ControlTemplate="{StaticResource EntryViewControlTemplate}" />
                        <local:CustomButton
                            Grid.Row="2"
                            Command="{Binding LoginCommand}"
                            x:Name="btn_login"
                            CornerRadius="10"
                            HorizontalOptions="Center"
                            BackgroundColor="{AppThemeBinding Dark={StaticResource ButtonBackgroundColorDark}, Light={StaticResource ButtonBackgroundColor}}"
                            TextColor="{AppThemeBinding Dark={StaticResource TextColorDark}, Light={StaticResource TextColor}}"
                            Text="Log in"
                            FontSize="20"></local:CustomButton>
                    </Grid>
                </ScrollView>
            </Grid>
        </Frame>


        <!-- SEARCH BAR -->
        <Frame
            Grid.Row="1"
            Grid.Column="0"
            Grid.ColumnSpan="12"
            Margin="5"
            BorderColor="{AppThemeBinding Dark={StaticResource BorderColorDark}, Light={StaticResource BorderColor}}"
            Padding="0"
            CornerRadius="15"
            IsClippedToBounds="False"
            HorizontalOptions="CenterAndExpand"
            VerticalOptions="FillAndExpand"
            MinimumWidthRequest="500"
            WidthRequest="500"
            Opacity=".5">
            <VisualStateManager.VisualStateGroups>
                <VisualStateGroup
                    x:Name="opa">
                    <VisualState
                        x:Name="Normal">
                        <VisualState.Setters>

                        </VisualState.Setters>
                    </VisualState>
                    <VisualState
                        x:Name="Focused">
                        <VisualState.Setters>
                            <Setter
                                Property="BackgroundColor"
                                Value="White"></Setter>
                            <Setter
                                Property="Opacity"
                                Value=".9"></Setter>
                        </VisualState.Setters>
                    </VisualState>
                </VisualStateGroup>
            </VisualStateManager.VisualStateGroups>
            <Grid
                HorizontalOptions="CenterAndExpand"
                WidthRequest="500"
                ColumnDefinitions="auto,auto">
                <local:RoundedEntry
                    Completed="SearchButton_Clicked"
                    Grid.Column="0"
                    HorizontalOptions="FillAndExpand"
                    VerticalOptions="FillAndExpand"
                    Grid.ColumnSpan="3"
                    x:Name="SearchField"
                    Placeholder="Where to ya scallywag?"
                    FontSize="24">
                </local:RoundedEntry>

                <ffimageloadingsvg:SvgCachedImage
                    Grid.Column="2"
                    VerticalOptions="Center"
                    HorizontalOptions="End"
                    HeightRequest="50"
                    WidthRequest="50"
                    Margin="0,0,20,0"
                    Source="resource://Puma.Resources.SearchIcon.svg">
                </ffimageloadingsvg:SvgCachedImage>

                <!--- TEST-->
                <local:CustomButton
                    HorizontalOptions="End"
                    BackgroundColor="red"
                    Grid.Column="2"
                    Opacity=".1"
                    Text="Testa maps"
                    Clicked="SearchButton_Clicked">
                </local:CustomButton>
            </Grid>
        </Frame>


        <!-- SETTINGS POPUP -->
        <Frame
            IsVisible="{Binding settingsPopupState}"
            ClassId="settingsPopup"
            Grid.Row="2"
            Grid.RowSpan="8"
            Grid.ColumnSpan="12"
            HorizontalOptions="CenterAndExpand"
            VerticalOptions="CenterAndExpand"
            WidthRequest="320"
            MinimumHeightRequest="370"
            HeightRequest="500"
            BackgroundColor="{AppThemeBinding Dark={StaticResource PopUpBackgroundColorDark}, Light={StaticResource PopUpBackgroundColor}}"
            Opacity=".9">
            <!-- HEADER -->
            <Grid
                RowDefinitions="auto,.9*">
                <Grid
                    Grid.Row="0"
                    ColumnDefinitions="1*,1*,.2*"
                    RowDefinitions="auto,auto">
                    <Label
                        FontSize="24"
                        Text="Settings" />
                    <local:CustomButton
                        Grid.Column="3"
                        VerticalOptions="StartAndExpand"
                        Margin="-10,-10,-10,0"
                        Command="{Binding ClosePopupCommand}"
                        CornerRadius="15"
                        BackgroundColor="{AppThemeBinding 
                                  Dark={StaticResource ButtonBackgroundColorDark}, 
                                  Light={StaticResource ButtonBackgroundColor}}"
                        BorderColor="{AppThemeBinding Dark={StaticResource BorderColorDark}, Light={StaticResource BorderColor}}"
                        TextColor="{AppThemeBinding Dark={StaticResource TextColorDark}, Light={StaticResource TextColor}}"
                        Text="X"
                        HorizontalOptions="EndAndExpand" />
                </Grid>

                <!-- INPUTS -->
                <Grid
                    Grid.Row="1"
                    x:Name="settingsPopup"
                    RowDefinitions="auto,auto,auto,auto,auto,auto,auto,auto,auto,auto"
                    ColumnSpacing="0"
                    IsVisible="{Binding EditSettingsVisible}">
                    <ScrollView>
                        <Grid
                            x:Name="settingsInputs"
                            >
                            <control:EntryViewControl
                                Grid.Row="1"
                                EntryText="{Binding EditEmail, Mode=TwoWay}"
                                PlaceholderText="{Binding CurrentUserEmail}"
                                ControlTemplate="{StaticResource EntryViewControlTemplate}"/>
                            <control:EntryViewControl
                                Grid.Row="2"
                                EntryText="{Binding EditPassword, Mode=TwoWay}"
                                PlaceholderText="Password"
                                ControlTemplate="{StaticResource EntryViewControlTemplate}" />
                            <control:EntryViewControl
                                Grid.Row="3"
                                EntryText="{Binding EditDisplayName, Mode=TwoWay}"
                                PlaceholderText="{Binding CurrentUserDisplayName}"
                                ControlTemplate="{StaticResource EntryViewControlTemplate}" />
                            <control:EntryViewControl
                                Grid.Row="4"
                                EntryText="{Binding EditFirstName, Mode=TwoWay}"
                                PlaceholderText="{Binding CurrentUserFirstName}"
                                ControlTemplate="{StaticResource EntryViewControlTemplate}" />
                            <control:EntryViewControl
                                Grid.Row="5"
                                EntryText="{Binding EditSurname, Mode=TwoWay}"
                                PlaceholderText="{Binding CurrentUserLastName}"
                                ControlTemplate="{StaticResource EntryViewControlTemplate}" />

                            <Button
                                HeightRequest="50"
                                WidthRequest="150"
                                VerticalOptions="Center"
                                Grid.Row="7"
                                Command="{Binding EditUserCommand}"
                                CornerRadius="10"
                                BorderColor="{AppThemeBinding Dark={StaticResource BorderColorDark}, Light={StaticResource BorderColor}}"
                                HorizontalOptions="Center"
                                BackgroundColor="{AppThemeBinding Dark={StaticResource ButtonBackgroundColorDark}, Light={StaticResource ButtonBackgroundColor}}"
                                TextColor="{AppThemeBinding Dark={StaticResource TextColorDark}, Light={StaticResource TextColor}}"
                                Text="Save Changes"
                                FontSize="20">
                            </Button>
                            <Button
                                HeightRequest="50"
                                WidthRequest="150"
                                VerticalOptions="Center"
                                Grid.Row="8"    
                                Command="{Binding DeleteUserCommand}"
                                CornerRadius="10"
                                BorderColor="{AppThemeBinding Dark={StaticResource BorderColorDark}, Light={StaticResource BorderColor}}"
                                HorizontalOptions="Center"
                                BackgroundColor="{AppThemeBinding Dark=IndianRed, Light=IndianRed}"
                                TextColor="{AppThemeBinding Dark={StaticResource TextColorDark}, Light={StaticResource TextColor}}"
                                Text="Delete User"
                                FontSize="20">
                            </Button>
                        </Grid>
                    </ScrollView>
                </Grid>
            </Grid>
        </Frame>

    </Grid>
</ContentPage>
